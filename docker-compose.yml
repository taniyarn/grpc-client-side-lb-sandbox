version: "3"

services:
  server:
    build:
      context: .
      dockerfile: server/Dockerfile
    environment:
      - SERVER_PORT=50051
    deploy:
      restart_policy:
        condition: on-failure

  proxy:
    build:
      context: .
      dockerfile: client/Dockerfile
    entrypoint:
      ["/client", "-proxy-port", "50050", "-server-ports", "server:50051"]
    ports:
      - "50050:50050"
    depends_on:
      - server
